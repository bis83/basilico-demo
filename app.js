(()=>{const S=(e,t,n)=>{e.addEventListener(t,n)},oe=()=>document.getElementById("canvas"),W=()=>document.getElementById("message"),Y=e=>{const t=W();t.style.display="",t.textContent=e},re=()=>{const e=W();e.style.display="none"};const x=e=>e!==void 0,se=(e,t)=>Math.floor(e/t),ie=(e,t)=>(e%t+t)%t,B=e=>e/180*Math.PI;const U=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],ae=e=>{const t=U(e,e);return Math.sqrt(t)},ce=(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],fe=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]];const N=e=>{const t=ae(e);return[e[0]/t,e[1]/t,e[2]/t]},k=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],q=(e,t)=>{const n=B(e),o=B(t);return[Math.cos(o)*Math.cos(n),Math.sin(o),Math.cos(o)*Math.sin(n)]},de=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],le=(e,t)=>[e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15]],ue=e=>{const t=e[0]*e[5]-e[1]*e[4],n=e[0]*e[6]-e[2]*e[4],o=e[0]*e[7]-e[3]*e[4],r=e[1]*e[6]-e[2]*e[5],i=e[1]*e[7]-e[3]*e[5],s=e[2]*e[7]-e[3]*e[6],a=e[8]*e[13]-e[9]*e[12],f=e[8]*e[14]-e[10]*e[12],d=e[8]*e[15]-e[11]*e[12],m=e[9]*e[14]-e[10]*e[13],l=e[9]*e[15]-e[11]*e[13],u=e[10]*e[15]-e[11]*e[14];let c=t*u-n*l+o*m+r*d-i*f+s*a;return c?(c=1/c,[(e[5]*u-e[6]*l+e[7]*m)*c,(e[2]*l-e[1]*u-e[3]*m)*c,(e[13]*s-e[14]*i+e[15]*r)*c,(e[10]*i-e[9]*s-e[11]*r)*c,(e[6]*d-e[4]*u-e[7]*f)*c,(e[0]*u-e[2]*d+e[3]*f)*c,(e[14]*o-e[12]*s-e[15]*n)*c,(e[8]*s-e[10]*o+e[11]*n)*c,(e[4]*l-e[5]*d+e[7]*a)*c,(e[1]*d-e[0]*l-e[3]*a)*c,(e[12]*i-e[13]*o+e[15]*t)*c,(e[9]*o-e[8]*i-e[11]*t)*c,(e[5]*f-e[4]*m-e[6]*a)*c,(e[0]*m-e[1]*f+e[2]*a)*c,(e[13]*n-e[12]*r-e[14]*t)*c,(e[8]*r-e[9]*n+e[10]*t)*c]):de()};const X=(e,t,n,o)=>{e[12]=t,e[13]=n,e[14]=o},H=(e,t)=>{const n=B(e),o=Math.sin(n),r=Math.cos(n);return[r,0,o,0,0,1,0,0,-o,0,r,0,0,0,0,1]};const me=(e,t,n)=>{const o=N(fe(t,e)),r=N(k(n,o)),i=k(o,r),s=U(e,r),a=U(e,i),f=U(e,o);return[r[0],i[0],o[0],0,r[1],i[1],o[1],0,r[2],i[2],o[2],0,-s,-a,-f,1]},he=(e,t,n,o)=>{const r=1/Math.tan(e),i=r/t,s=o/(o-n),a=-(s*n);return[i,0,0,0,0,r,0,0,0,0,s,1,0,0,a,0]};const be=async(e,t)=>{e.adapter=await navigator.gpu.requestAdapter(),e.device=await e.adapter.requestDevice(),e.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),e.canvas=oe(),e.context=e.canvas.getContext("webgpu"),e.context.configure({device:e.device,format:e.canvasFormat,alphaMode:"opaque"});const n=e.device;if(e.buffer)for(let r=0;r<e.buffer.length;++r){const i=e.buffer[r],s=await Te(t[i.embed]),a=n.createBuffer({size:s.length,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.INDEX,mappedAtCreation:!0}),f=new DataView(a.getMappedRange());for(let d=0;d<s.length;++d)f.setUint8(d,s[d]);a.unmap(),e.buffer[r]=a}if(e.shader)for(let r=0;r<e.shader.length;++r){const i=e.shader[r],s=await Oe(t[i.embed]),a=n.createShaderModule({code:s});e.shader[r]=a}e.bindGroupLayout=[],e.pipelineLayout=[],e.pipeline=[],e.sampler=[],e.bindGroup=[],e.cbuffer=[],e.gbuffer=[];const o=(r,i,s)=>{e.cbuffer[r]=n.createBuffer({size:i,usage:s|GPUBufferUsage.COPY_DST})};o(0,512,GPUBufferUsage.UNIFORM),o(1,229376,GPUBufferUsage.STORAGE),o(2,65536,GPUBufferUsage.VERTEX),o(3,40960,GPUBufferUsage.INDIRECT),e.sampler[0]=n.createSampler({magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),e.bindGroupLayout[0]=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),e.bindGroupLayout[1]=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:5,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),e.pipelineLayout[0]=n.createPipelineLayout({bindGroupLayouts:[e.bindGroupLayout[0]]}),e.pipelineLayout[1]=n.createPipelineLayout({bindGroupLayouts:[e.bindGroupLayout[1]]}),e.bindGroup[0]=n.createBindGroup({layout:e.bindGroupLayout[0],entries:[{binding:0,resource:{buffer:e.cbuffer[0]}},{binding:1,resource:{buffer:e.cbuffer[1]}}]}),ge(e)},j=(e,t)=>{for(let n=0;n<e.id.length;++n)if(e.id[n].name===t)return n;return-1},ye=e=>{const t=e.device,n=e.canvas;if(n.width!==n.clientWidth||n.height!==n.clientHeight){n.width=n.clientWidth,n.height=n.clientHeight;const i=a=>{x(e.gbuffer[a])&&(e.gbuffer[a].destroy(),delete e.gbuffer[a])};i(0),i(1),i(2),i(3),i(4);const s=a=>{x(e.bindGroup[a])&&delete e.bindGroup[a]};s(1),s(2),s(3)}const o=(i,s)=>{x(e.gbuffer[i])||(e.gbuffer[i]=t.createTexture({size:[n.width,n.height],format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}))};o(0,"depth32float"),o(1,"rgb10a2unorm"),o(2,"rgba8unorm"),o(3,"rgba8unorm"),o(4,"rgba16float");const r=(i,s,a,f,d)=>{x(e.bindGroup[i])||(e.bindGroup[i]=t.createBindGroup({layout:e.bindGroupLayout[1],entries:[{binding:0,resource:{buffer:e.cbuffer[0]}},{binding:1,resource:e.gbuffer[s].createView()},{binding:2,resource:e.gbuffer[a].createView()},{binding:3,resource:e.gbuffer[f].createView()},{binding:4,resource:e.gbuffer[d].createView()},{binding:5,resource:e.sampler[0]}]}))};r(1,0,1,2,3),r(2,0,1,1,1),r(3,0,4,4,4)},pe=e=>{const t=e.data.gpu,n=t.device,o=new Float32Array(68);{const r=R(e).camera,i=t.canvas.width/t.canvas.height,s=B(r.fov),[a,f,d,m,l]=M(r.offset,0,0,0,0,0),u=q(m,l),c=[a,f,d],h=ce(c,u),g=me(c,h,[0,1,0]),P=he(s,i,r.near,r.far),b=le(g,P),w=ue(b);o.set(b,0),o.set(w,16),o.set(g,32),o.set(c,48)}{const r=R(e).light,[i,s,a,f,d]=M(r.offset,0,0,0,0,0),m=p(r.color,0,0,0,0),l=p(r.ambient0,0,0,0,0),u=p(r.ambient1,0,0,0,0),c=q(f,d);o.set(c,52),o.set(m,56),o.set(l,60),o.set(u,64)}n.queue.writeBuffer(t.cbuffer[0],0,o)},ve=e=>{const t=e.data.gpu,n=t.device,o=[];o.length=t.mesh.length;for(let l=0;l<o.length;++l)o[l]=[];const r=new Float32Array(28),i=4*28;let s=0;for(const l of R(e).room){const u=ze(e,l.data);if(u&&u.layout)for(const c of u.layout)for(let h=0;h<c.indices.length;++h){const G=ie(h,c.divisor),g=se(h,c.divisor),[P,b,w,V,A]=M(l.offset,G*c.unit,0,g*c.unit,0,0),E=c.node[c.indices[h]];if(E)for(const L of E.mesh){const _=u.mesh[L];if(!_)continue;const $=j(t,_.data);if($<0)continue;for(const ne of t.id[$].mesh)o[ne].push(s);const[T,O,C,D,Q]=M(_.offset,P,b,w,V,A),I=H(D,Q);X(I,T,O,C);const Z=p(_.factor0,1,1,1,1),ee=p(_.factor1,1,1,1,0),te=p(_.factor2,0,0,0,0);r.set(I,0),r.set(Z,16),r.set(ee,20),r.set(te,24),n.queue.writeBuffer(t.cbuffer[1],s*i,r),s+=1}}}for(const l of R(e).mob){const u=Ie(e,l.data);if(!u)continue;const[c,h,G,g,P]=M(l.offset,0,0,0,0,0);for(const b of u.mesh){const w=j(t,b.data);if(w<0)continue;for(const D of t.id[w].mesh)o[D].push(s);const[V,A,E,L,_]=M(b.offset,c,h,G,g,P),$=H(L,_);X($,V,A,E);const T=p(b.factor0,1,1,1,1),O=p(b.factor1,1,1,1,0),C=p(b.factor2,0,0,0,0);r.set($,0),r.set(T,16),r.set(O,20),r.set(C,24),n.queue.writeBuffer(t.cbuffer[1],s*i,r),s+=1}}const a=[];let f=0,d=0;const m=new Uint32Array(5);for(let l=0;l<o.length;++l){if(o[l].length<=0)continue;const u=t.mesh[l],c=o[l].length;n.queue.writeBuffer(t.cbuffer[2],f*4,new Uint32Array(o[l])),m[0]=u.count,m[1]=c,m[2]=0,m[3]=0,m[4]=0,n.queue.writeBuffer(t.cbuffer[3],d,m),a.push({id:l,first:f,offset:d}),f+=c,d+=20}return a},ge=e=>{const t=e.device;e.pipeline[0]=t.createRenderPipeline({layout:e.pipelineLayout[0],vertex:{module:e.shader[0],entryPoint:"VS",buffers:[{arrayStride:4,attributes:[{format:"uint32",offset:0,shaderLocation:0}],stepMode:"instance"},{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:1}]},{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:2}]}]},fragment:{module:e.shader[0],entryPoint:"FS",targets:[{format:"rgb10a2unorm"},{format:"rgba8unorm"},{format:"rgba8unorm"},{format:"rgba16float"}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"},primitive:{cullMode:"back",frontFace:"cw"}}),e.pipeline[1]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_SSAO",targets:[{format:"rgba8unorm",blend:{color:{operation:"min",srcFactor:"one",dstFactor:"one"},alpha:{}},writeMask:GPUColorWrite.RED}]}}),e.pipeline[2]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDR",targets:[{format:"rgba16float",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"not-equal",format:"depth32float"}}),e.pipeline[3]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDRSky",targets:[{format:"rgba16float",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"equal",format:"depth32float"}}),e.pipeline[4]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDR2LDR",targets:[{format:e.canvasFormat}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"always",format:"depth32float"}}),e.pipeline[5]=t.createRenderPipeline({layout:e.pipelineLayout[0],vertex:{module:e.shader[2],entryPoint:"VS",buffers:[{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:0}]},{arrayStride:4,attributes:[{format:"unorm8x4",offset:0,shaderLocation:1}]}]},fragment:{module:e.shader[2],entryPoint:"FS",targets:[{format:e.canvasFormat}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"less",format:"depth32float"},primitive:{topology:"line-list"}})},we=e=>{const t=e.data.gpu;ye(t)},_e=e=>{pe(e);const t=ve(e),n=e.data.gpu,o=n.device,r=o.createCommandEncoder();Se(r,n,t),xe(r,n),Ge(r,n),Pe(r,n),o.queue.submit([r.finish()])},Se=(e,t,n)=>{const o=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"},colorAttachments:[{view:t.gbuffer[1].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[2].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[3].createView(),clearValue:{r:1,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[4].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});for(const r of n){o.setPipeline(t.pipeline[0]),o.setBindGroup(0,t.bindGroup[0]),o.setVertexBuffer(0,t.cbuffer[2],r.first*4);const i=t.mesh[r.id];if(i.vb0){const[s,a,f]=i.vb0;o.setVertexBuffer(1,t.buffer[s],a,f)}if(i.vb1){const[s,a,f]=i.vb1;o.setVertexBuffer(2,t.buffer[s],a,f)}if(i.ib){const[s,a,f]=i.ib;o.setIndexBuffer(t.buffer[s],"uint16",a,f)}o.drawIndexedIndirect(t.cbuffer[3],r.offset)}o.end()},xe=(e,t)=>{const n=e.beginRenderPass({colorAttachments:[{view:t.gbuffer[3].createView(),loadOp:"load",storeOp:"store"}]});n.setPipeline(t.pipeline[1]),n.setBindGroup(0,t.bindGroup[2]),n.draw(4),n.end()},Ge=(e,t)=>{const n=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthReadOnly:!0},colorAttachments:[{view:t.gbuffer[4].createView(),loadOp:"load",storeOp:"store"}]});n.setPipeline(t.pipeline[2]),n.setBindGroup(0,t.bindGroup[1]),n.draw(4),n.setPipeline(t.pipeline[3]),n.draw(4),n.end()},Pe=(e,t)=>{const n=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthReadOnly:!0},colorAttachments:[{view:t.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});n.setPipeline(t.pipeline[4]),n.setBindGroup(0,t.bindGroup[3]),n.draw(4),n.end()},J=(e,t)=>{e[t]||(e[t]={})},v=(e,t,n)=>{J(e,t),n=n||0;const o=e[t];o&&!o.hold&&(o.value=Math.max(0,n))},F=(e,t,n,o)=>{J(e,t),n=n||0,o=o||!1;const r=e[t];r&&(r.value=Math.max(0,n),r.hold=o)},Me=(e,t)=>{const n=e[t];n&&(n.history=n.value)},Be=(e,t)=>{const n=e[t];return n&&n.value||0},Re=(e,t)=>{const n=e[t];return n?(n.value||0)-(n.history||0):0},$e=e=>{if(!e)return!1;for(const t of e.buttons)if(t.value>.5)return!0;for(const t of e.axes)if(Math.abs(t)>.5)return!0;return!1},Ee=e=>{const t=e.hid,n=e.data.hid,o=()=>{for(const s in n.keyboard)F(t.map,n.keyboard[s],0,!1);for(const s of n.mouse.button)F(t.map,s,0,!1)},r=(s,a,f)=>{const d=n.keyboard[s.code];d&&(F(t.map,d,a,f),s.preventDefault(),t.last=-1)},i=(s,a,f)=>{const d=n.mouse.button[s.button];d&&(F(t.map,d,a,f),s.preventDefault(),t.last=-1)};S(document.body,"contextmenu",s=>{s.preventDefault()}),S(window,"blur",s=>{o()}),S(document,"keydown",s=>{r(s,1,!0)}),S(document,"keyup",s=>{r(s,0,!1)}),S(document,"mousedown",s=>{i(s,1,!0)}),S(document,"mouseup",s=>{i(s,0,!1)}),S(document,"mousemove",s=>{if(!(s.buttons&2))return;const a=.25,f=n.mouse.movementX;f&&(v(t.map,f[0],-s.movementX*a),v(t.map,f[1],s.movementX*a));const d=n.mouse.movementY;d&&(v(t.map,d[0],-s.movementY*a),v(t.map,d[1],s.movementY*a)),s.preventDefault(),t.last=-1}),o()},Fe=(e,t)=>{const n=e.hid,o=e.data.hid;v(n.map,o.timer,t/1e3);{const r=navigator.getGamepads();for(let s=0;s<r.length;++s)if($e(r[s])){n.last=s;break}const i=r[n.last];if(i){const s=o.gamepad;for(let a=0;a<i.buttons.length;++a){const f=s.buttons[a];f&&v(n.map,f,i.buttons[a].value)}for(let a=0;a<i.axes.length;++a){const f=s.axes[a];if(!f)continue;const d=Math.trunc(i.axes[a]*4)/4;v(n.map,f[0],-d),v(n.map,f[1],d)}}}},Ue=e=>{const t=e.hid;for(const n in t.map)Me(t.map,n),v(t.map,n,0)},z={},Ve=e=>{const t=R(e);if(!t)return;const n=K(e,t.data);if(!n)return;const o=n.step||[],r=s=>{for(let a=0;a<o.length;++a)if(o[a].label&&o[a].label===s)return a;return-1};let i=!1;for(;!i;){const s=o[t.step];if(s){if(s.event){const a=z[s.event];a&&a(e)}s.goto?t.step=r(s.goto):t.step+=1,s.yield&&(i=!0)}else t.step=-1,i=!0}t.step<0&&e.stage.pop()},Ae=(e,t)=>{const n=K(e,t);if(!n)return;const o={data:t,step:0,room:structuredClone(n.room)||[],mob:structuredClone(n.mob)||[],camera:structuredClone(n.camera[0]),light:structuredClone(n.light[0])};e.stage.push(o)},M=(e,t,n,o,r,i)=>(e&&(t+=e.x||0,n+=e.y||0,o+=e.z||0,r+=e.ha||0,i+=e.va||0),[t,n,o,r,i]),p=(e,t,n,o,r)=>(e&&(x(e.r)&&(t=e.r),x(e.g)&&(n=e.g),x(e.r)&&(o=e.b),x(e.a)&&(r=e.a)),[t,n,o,r]),Le=e=>{e.data.loading+=1,(async()=>{const o=await(await fetch("app.json")).json(),r=e.data;Object.assign(r,o),Ee(e),r.gpu&&await be(r.gpu,r.embed),Ae(e,"main"),delete r.embed,r.loading-=1})()},Te=async e=>{const t=window.atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);const o=new Blob([n]).stream().pipeThrough(new DecompressionStream("deflate-raw")),r=await new Response(o).arrayBuffer();return new Uint8Array(r)},Oe=async e=>{const t=window.atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);const o=new Blob([n]).stream().pipeThrough(new DecompressionStream("deflate-raw"));return await new Response(o).text()},Ce=async()=>{if(!navigator.gpu){Y("ERROR: WebGPU not supported.");return}const e={data:{loading:0},hid:{map:{},last:0},stage:[]};Le(e);const t=n=>{De(e)&&(Fe(e,n),we(e),Ve(e),_e(e),Ue(e)),requestAnimationFrame(t)};requestAnimationFrame(t)},De=e=>e.data.loading<=0;const ze=(e,t)=>e.data.room[t],Ie=(e,t)=>e.data.mob[t],K=(e,t)=>e.data.stage[t],y=(e,t)=>Be(e.hid.map,t),Ne=(e,t)=>Re(e.hid.map,t),R=e=>e.stage.at(-1);z.setup=e=>{re()};z.update=e=>{const t=Ne(e,"t"),n=R(e),o=n.mob.find(i=>i.data==="p000");if(o){const i=[0,0];i[0]+=-y(e,"l0"),i[0]+=y(e,"l1"),i[1]+=y(e,"l2"),i[1]+=-y(e,"l3");const s=[0,0];s[0]+=-y(e,"r0"),s[0]+=y(e,"r1"),s[1]+=y(e,"r2"),s[1]+=-y(e,"r3");const a=y(e,"b1");if(s){const u=-s[0],c=s[1];o.offset.ha+=90*t*u,o.offset.va+=90*t*c,o.offset.va=Math.max(-60,Math.min(o.offset.va,80))}if(i){const l=a?4:2,u=B(o.offset.ha+90),c=B(o.offset.ha),h=-i[0],G=i[1],g=h*Math.cos(u)+G*Math.cos(c),P=h*Math.sin(u)+G*Math.sin(c),b=l*t*g,w=l*t*P;o.offset.x+=b,o.offset.z+=w}y(e,"a2")&&(o.offset.y-=.75*t),y(e,"a3")&&(o.offset.y+=.75*t);const m=n.camera;m.offset.x=o.offset.x,m.offset.y=o.offset.y,m.offset.z=o.offset.z,m.offset.ha=o.offset.ha,m.offset.va=o.offset.va}const r=n.light;r.offset.ha+=45*t};S(window,"load",()=>{Y("Welcome Basilico."),Ce()});})();
