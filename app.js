(()=>{const V=e=>{const t=window.atob(e),n=new ArrayBuffer(t.length),o=new DataView(n);for(let r=0;r<t.length;++r)o.setUint8(r,t.charCodeAt(r));return n};const S=e=>e/180*Math.PI,se=(e,t)=>Math.sqrt(e*e+t*t),D=(e,t)=>{const n=se(e,t);return n!=0?[e/n,t/n]:[0,0]},he=([e,t],n)=>[e*n,t*n],me=([e,t],n,o,r,c)=>n<=e&&e<=o&&r<=t&&t<=c,O=([e,t],n,[o,r])=>{const[c,i]=[o-e,r-t],l=se(c,i);if(n<=l)return[e,t];const[d,m]=D(c,i),[E,A]=he([d,m],l-n);return[e+E,t+A]},k=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],Ee=e=>{const t=k(e,e);return Math.sqrt(t)},xe=(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],Ae=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]];const K=e=>{const t=Ee(e);return[e[0]/t,e[1]/t,e[2]/t]},z=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],we=(e,t)=>{const n=S(e),o=S(t);return[Math.cos(o)*Math.cos(n),Math.cos(o)*Math.sin(n),Math.sin(o)]},F=(e,t,n)=>[e*2,t*2,n*.5],ve=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ge=(e,t)=>[e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15]],Te=e=>{const t=e[0]*e[5]-e[1]*e[4],n=e[0]*e[6]-e[2]*e[4],o=e[0]*e[7]-e[3]*e[4],r=e[1]*e[6]-e[2]*e[5],c=e[1]*e[7]-e[3]*e[5],i=e[2]*e[7]-e[3]*e[6],l=e[8]*e[13]-e[9]*e[12],d=e[8]*e[14]-e[10]*e[12],m=e[8]*e[15]-e[11]*e[12],E=e[9]*e[14]-e[10]*e[13],A=e[9]*e[15]-e[11]*e[13],y=e[10]*e[15]-e[11]*e[14];let h=t*y-n*A+o*E+r*m-c*d+i*l;return h?(h=1/h,[(e[5]*y-e[6]*A+e[7]*E)*h,(e[2]*A-e[1]*y-e[3]*E)*h,(e[13]*i-e[14]*c+e[15]*r)*h,(e[10]*c-e[9]*i-e[11]*r)*h,(e[6]*m-e[4]*y-e[7]*d)*h,(e[0]*y-e[2]*m+e[3]*d)*h,(e[14]*o-e[12]*i-e[15]*n)*h,(e[8]*i-e[10]*o+e[11]*n)*h,(e[4]*A-e[5]*m+e[7]*l)*h,(e[1]*m-e[0]*A-e[3]*l)*h,(e[12]*c-e[13]*o+e[15]*t)*h,(e[9]*o-e[8]*c-e[11]*t)*h,(e[5]*d-e[4]*E-e[6]*l)*h,(e[0]*E-e[1]*d+e[2]*l)*h,(e[13]*n-e[12]*r-e[14]*t)*h,(e[8]*r-e[9]*n+e[10]*t)*h]):ve()},B=(e,t,n)=>[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1],pe=(e,t,n,o)=>{e[12]=t,e[13]=n,e[14]=o},ye=(e,t,n)=>[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1],De=(e,t,n)=>{const o=K(Ae(t,e)),r=K(z(n,o)),c=z(o,r),i=k(e,r),l=k(e,c),d=k(e,o);return[r[0],c[0],o[0],0,r[1],c[1],o[1],0,r[2],c[2],o[2],0,-i,-l,-d,1]},Me=(e,t,n,o)=>{const r=1/Math.tan(e),c=r/t,i=o/(o-n),l=-(i*n);return[c,0,0,0,0,r,0,0,0,0,i,1,0,0,l,0]},Re=(e,t,n,o)=>{const r=2/e,c=2/t,i=1/(o-n),l=n/(n-o);return[r,0,0,0,0,c,0,0,0,0,i,0,0,0,l,1]};var u=null;const x=(e,t,n)=>{e.addEventListener(t,n)},Pe=()=>{const e=document.body;e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.msUserSelect="none",e.style.mozUserSelect="none"},Se=()=>{const e=document.body;e.style.touchAction="none"},Oe=()=>{Pe(),Se(),u={},u.mode=0,u.gamepad={index:null,lx:0,ly:0,rx:0,ry:0,b0:!1,b1:!1,b8:!1,b9:!1,lt:!1,rt:!1},u.keyboard={w:!1,a:!1,s:!1,d:!1,up:!1,left:!1,down:!1,right:!1,z:!1,x:!1,space:!1,lctrl:!1,esc:!1},u.touch=new Map,u.click=[],x(window,"focus",e=>{}),x(window,"blur",e=>{}),x(window,"resize",e=>{}),x(window,"gamepadconnected",e=>{u.gamepad.index=e.gamepad.index,u.mode=1}),x(window,"gamepaddisconnected",e=>{u.gamepad.index===e.gamepad.index&&(u.gamepad.index=null)}),x(document,"keydown",e=>{W(u.keyboard,e.code,!0)&&(u.mode=2,e.preventDefault())}),x(document,"keyup",e=>{W(u.keyboard,e.code,!1)&&(u.mode=2,e.preventDefault())}),x(document.body,"contextmenu",e=>{e.preventDefault()}),x(document.body,"pointerdown",e=>{u.touch.set(e.pointerId,{x:e.clientX,y:e.clientY,sx:e.clientX,sy:e.clientY,time:performance.now()}),u.mode=0}),x(document.body,"pointerup",e=>{Ie(e.pointerId),u.touch.delete(e.pointerId),u.mode=0}),x(document.body,"pointerout",e=>{u.touch.delete(e.pointerId),u.mode=0}),x(document.body,"pointermove",e=>{const t=u.touch.get(e.pointerId);t&&(t.x=e.clientX,t.y=e.clientY,u.mode=0)})},W=(e,t,n)=>{switch(t){case"KeyW":e.w=n;break;case"KeyA":e.a=n;break;case"KeyS":e.s=n;break;case"KeyD":e.d=n;break;case"ArrowUp":e.up=n;break;case"ArrowLeft":e.left=n;break;case"ArrowDown":e.down=n;break;case"ArrowRight":e.right=n;break;case"KeyZ":e.z=n;break;case"KeyX":e.x=n;break;case"Space":e.space=n;break;case"ControlLeft":e.lctrl=n;break;case"Escape":e.esc=n;break;default:return!1}return!0},Ie=e=>{const t=u.touch.get(e);t&&performance.now()-t.time<250&&u.click.push({x:t.x,y:t.y})},Ge=e=>{if(e.index!==null){const n=navigator.getGamepads()[e.index];e.lx=Math.trunc(n.axes[0]*4)/4,e.ly=Math.trunc(n.axes[1]*4)/4,e.rx=Math.trunc(n.axes[2]*4)/4,e.ry=Math.trunc(n.axes[3]*4)/4,e.b0=n.buttons[0].value>=.5,e.b1=n.buttons[1].value>=.5,e.b8=n.buttons[8].value>=.5,e.b9=n.buttons[9].value>=.5,e.lt=n.buttons[6].value>=.5,e.rt=n.buttons[7].value>=.5,!!(e.lx||e.ly||e.rx||e.ry||e.b0||e.b1||e.b8||e.b9||e.lt||e.rt)&&(u.mode=1)}},ke=()=>{Ge(u.gamepad)},be=()=>{u.click.length=0},Le=e=>{const t=localStorage.getItem(e);return t==null?null:JSON.parse(t)},Ue=(e,t)=>{const n=JSON.stringify(t);localStorage.setItem(e,n)};var s=null;const Ne=()=>{s=document.getElementById("main").getContext("webgl2")},q=(e,t)=>{let n=s.createTexture();return s.bindTexture(s.TEXTURE_2D,n),t==0&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST)),t==1&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e),s.bindTexture(s.TEXTURE_2D,null),n},Fe=(e,t)=>{s.bindTexture(s.TEXTURE_2D,e),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,t),s.bindTexture(s.TEXTURE_2D,null)},J=(e,t)=>{const n=s.createShader(e);return s.shaderSource(n,t),s.compileShader(n),s.getShaderParameter(n,s.COMPILE_STATUS)?n:(s.deleteShader(n),null)},Be=(e,t)=>{const n=s.createProgram();return s.attachShader(n,e),s.attachShader(n,t),s.linkProgram(n),s.getProgramParameter(n,s.LINK_STATUS)?n:(s.deleteProgram(n),null)},j=(e,t)=>{let n=s.createBuffer();return s.bindBuffer(e,n),s.bufferData(e,t,s.STATIC_DRAW),n},I=(e,t,n,o,r,c)=>{s.enableVertexAttribArray(e),s.vertexAttribPointer(e,t,n,o,r,c)},Xe=()=>{const e=window.innerWidth;e!==s.canvas.width&&(s.canvas.width=e);const t=window.innerHeight;t!==s.canvas.height&&(s.canvas.height=t)},Ye=()=>{s.viewport(0,0,s.canvas.width,s.canvas.height),s.clearColor(0,0,0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)},Ce=(e,t)=>{s.enable(s.CULL_FACE),e?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST),t?(s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA)):(s.disable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA))},$e=(e,t)=>{t=t||0;const n=e.iv[t*3+0],o=e.iv[t*3+1],r=e.iv[t*3+2],c=[null,s.POINTS,s.LINES,s.TRIANGLES];e.i?s.drawElements(c[n],r,s.UNSIGNED_SHORT,2*o):s.drawArrays(c[n],o,r)},He=(e,t)=>{s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,e.tex),s.uniform1i(t,0)},Ve=(e,t)=>{const n=document.createElement("canvas");return n?(n.width=e,n.height=t,n):null},re=(e,t)=>{const n=e.getContext("2d");if(!n)return null;n.clearRect(0,0,e.width,e.height),n.fillStyle="white",n.textAlign="center",n.textBaseline="middle",n.font="24px monospace",n.fillText(t,e.width/2,e.height/2)};var Ke=null;const ze=()=>{Ke=new AudioContext};const Q=0,Z=1,ee=2,te=3,We=e=>{if(e.vao=s.createVertexArray(),s.bindVertexArray(e.vao),e.b&&(e.b=j(s.ARRAY_BUFFER,V(e.b)),e.bv))for(let t=0;t<e.bv.length;t+=2)switch(e.bv[t]){case Q:I(Q,3,s.FLOAT,!1,0,e.bv[t+1]);break;case Z:I(Z,3,s.HALF_FLOAT,!1,0,e.bv[t+1]);break;case ee:I(ee,4,s.UNSIGNED_BYTE,!0,0,e.bv[t+1]);break;case te:I(te,2,s.HALF_FLOAT,!1,0,e.bv[t+1]);break}return e.i&&(e.i=j(s.ELEMENT_ARRAY_BUFFER,V(e.i))),s.bindVertexArray(null),e},qe=e=>{if(e.vs=J(s.VERTEX_SHADER,e.vs),e.fs=J(s.FRAGMENT_SHADER,e.fs),e.prog=Be(e.vs,e.fs),e.u){const t={};for(let n of e.u)t[n]=s.getUniformLocation(e.prog,n);e.u=t}if(e.ub){const t={};let n=0;for(let o of e.ub){const r=s.getUniformBlockIndex(e.prog,o);s.uniformBlockBinding(e.prog,r,n),t[o]=n,n+=1}e.ub=t}return e};let X=0;const Je=e=>{if(e.cvs){const t=Ve(e.cvs.width,e.cvs.height);re(t,e.cvs.text),e.cvs=t,e.tex=q(e.cvs,e.s)}else{e.tex=null;const t=new Image;t.onload=()=>{e.tex=q(t,e.s),X-=1},t.src="img/"+e.src,X+=1}return e},w={index:null,pack:[]},je=()=>{fetch("data/index.json").then(t=>t.json()).then(t=>{w.index=t})},Qe=e=>{const t="data/pack"+e+".json";fetch(t).then(n=>n.json()).then(n=>{n.mesh&&(n.mesh=n.mesh.map(o=>We(o))),n.texture&&(n.texture=n.texture.map(o=>Je(o))),n.shader&&(n.shader=n.shader.map(o=>qe(o))),w.pack[e]=n})},p=(e,t)=>{if(t<0)return null;const n=w.index[e];if(!n)return null;const o=n[t];if(!o)return null;const r=w.pack[o.p];return r?r[e][o.i]:null},ce=e=>p("view",e),Ze=e=>p("mesh",e),ie=e=>p("texture",e),et=e=>p("shader",e),tt=e=>p("draw",e),b=e=>p("tile",e),le=e=>p("ui",e),nt=e=>p("event",e),ot=e=>w.index.view.findIndex(t=>t.n===e),st=e=>w.index.texture.findIndex(t=>t.n===e),rt=e=>w.index.item.findIndex(t=>t.n===e),ne=e=>w.index.tile.findIndex(t=>t.n===e),ct=e=>w.index.ui.findIndex(t=>t.n===e),ue=()=>!(w.index===null||w.pack.length<=0||X>0),g={},it=e=>{const t=g[e[0]];if(!t)return;const n=e.slice(1);t(...n)},M={t:performance.now(),dt:0,n:0},lt=e=>{M.dt=(e-M.t)/1e3,M.t=e,M.n+=1},R=[],Y=e=>{const t=ct(e);if(t<0)return null;const n=R[t];return n?n.value:null},ut=0,N=0,P=1,$=(e,t)=>{const n=window.innerWidth,o=window.innerHeight,r=window.devicePixelRatio,c=n/2+n/2*e.ox,i=o/2+o/2*e.oy,l=c+(e.x-e.w/2)*r,d=c+(e.x+e.w/2)*r,m=i+(e.y-e.h/2)*r,E=i+(e.y+e.h/2)*r;return me(t,l,d,m,E)},at=(e,t)=>{const n=u.mode;if(n===0){let o=!1;const r=u.click;for(let c of r)if($(t,[c.x,c.y])){o=!0;break}o?(e.value=!0,e.state=P):(e.value=!1,e.state=N)}else n===1?u.gamepad[t.gamepad]?e.state!==P?(e.value=!0,e.state=P):e.value=!1:(e.value=!1,e.state=N):n===2&&(u.keyboard[t.keyboard]?e.state!==P?(e.value=!0,e.state=P):e.value=!1:(e.value=!1,e.state=N))},dt=(e,t)=>{const n=u.mode;if(n===0){e.value=[0,0];for(const o of u.touch.values())if($(t,[o.sx,o.sy])){const r=o.x-o.sx,c=-(o.y-o.sy);e.value=D(r,c);break}}else if(n===1){const o=u.gamepad;e.value=D(o.lx,-o.ly)}else if(n===2){const o=u.keyboard,r=o.a?-1:o.d?1:0,c=o.w?1:o.s?-1:0;e.value=D(r,c)}},ft=(e,t)=>{const n=u.mode;if(n===0){e.value=[0,0];for(const o of u.touch.values())if($(t,[o.sx,o.sy])){const r=o.x-o.sx,c=-(o.y-o.sy);e.value=D(r,c);break}}else if(n===1){const o=u.gamepad;e.value=D(o.rx,-o.ry)}else if(n===2){const o=u.keyboard,r=o.right?1:o.left?-1:0,c=o.up?1:o.down?-1:0;e.value=D(r,c)}},_t=e=>{const t=window.innerWidth,n=window.innerHeight;for(const o of R)o&&(o.value=null);for(let o of e.ui){const r=le(o);if(!r)continue;R[o]||(R[o]={m:new Float32Array(16),value:null,state:ut});const c=R[o];switch(r.interact){case 1:at(c,r);break;case 2:dt(c,r);break;case 3:ft(c,r);break;default:break}const i=window.devicePixelRatio,l=r.ox*t/2,d=r.oy*n/2,m=ye(r.w/2*i,r.h/2*i,1);pe(m,l+r.x*i,-(d+r.y*i),0),c.m.set(m)}},_={w:0,h:0,a:[],b:[]},U=(e,t)=>(e=Math.floor(e),t=Math.floor(t),e<0||_.w<=e||t<0||_.h<=t?-1:e+t*_.h),H=(e,t)=>_.a[U(e,t)],ae=(e,t)=>_.b[U(e,t)],de=(e,t)=>{const n=H(e,t);if(!n)return 0;const o=b(n.no);return o?o.height*n.count:0},ht=(e,t)=>{const n=ae(e,t);if(!n)return 0;const o=b(n.no);return o?o.height:0},C=(e,t)=>de(e,t)+ht(e,t),mt=(e,t)=>H(e,t)==null,T=(e,t,n,o)=>{if(mt(e+n,t+o))return!0;const r=C(e,t),c=C(e+n,t+o);return Math.abs(r-c)>1},Et=(e,t)=>{_.w=e,_.h=t,_.a=[],_.a.length=e*t,_.b=[],_.b.length=e*t},xt=(e,t,n)=>{const o=U(e,t);o<0||(_.a[o]={no:n,count:1})},G=(e,t,n)=>{const o=U(e,t);o<0||(_.b[o]={no:n,dir:0})},At=e=>e,wt=e=>e,vt=1.75,a={x:0,y:0,ha:0,va:0,h:0},gt=(e,t,n,o)=>{a.x=e||0,a.y=t||0,a.ha=n||0,a.va=o||0,a.h=0},v={s:[],i:0},Tt=e=>v.s.findIndex(t=>t&&t.no===e),pt=()=>v.s.findIndex(e=>!e),yt=(e,t)=>{let n=Tt(e);if(n<0){if(n=pt(),n<0)return;v.s[n]={no:e,num:t};return}v.s[n].num+=t};const Dt=e=>{v.s.length=e,v.s.fill(null),v.i=0},Mt=e=>e,Rt=e=>e,Pt=e=>{for(let t of e.event){const n=nt(t);if(!n)continue;let o=!1;switch(n.trigger){case 0:o=!0;break;case 1:o=Y(n.target);break}if(!!o)for(const r of n.action)it(r)}},f={view:null,slot:null,cam:{eye:[0,0,0],vp:new Float32Array(16),ivp:new Float32Array(16),o:new Float32Array(16)},m:new Float32Array(16)},fe=()=>{f.slot=null,f.view=w.index.initial_view},St=e=>{const t=ot(e);t<0||(f.view=t)},Ot=()=>{f.view===null&&fe()},It=()=>{const e=window.innerWidth,t=window.innerHeight,n=S(30),o=.1,r=1e3,c=we(a.ha,a.va),i=F(a.x,a.y,a.h);i[2]+=vt;const l=xe(i,c),m=De(i,l,[0,0,1]),E=Me(n,e/t,o,r),A=ge(m,E);f.cam.vp.set(A),f.cam.ivp.set(Te(A)),f.cam.o.set(Re(e,t,0,1)),f.cam.eye=i},Gt=()=>{_.w=0,_.h=0,_.a.length=0,a.x=0,a.y=0,a.ha=0,a.va=0},kt=()=>{if(!f.slot)return!1;const e=Le(f.slot);return e?(e.pos&&Object.assign(a,e.pos),e.item&&Object.assign(v,Rt(e.item)),e.tile&&Object.assign(_,wt(e.tile)),!0):!1},bt=()=>{if(!f.slot)return;const e={};e.pos=a,e.item=Mt(v),e.tile=At(_),Ue(f.slot,e)},Lt=()=>{Xe(),Ye()},L=(e,t,n)=>{const o=tt(e);if(!o)return;Ce(o.depth,o.alpha);const r=et(o.shader);if(!r)return;s.useProgram(r.prog);const c=Ze(o.mesh);if(!c)return;s.bindVertexArray(c.vao),s.uniformMatrix4fv(r.u.vp,!1,o.ortho?f.cam.o:f.cam.vp);const i=ie(o.texture);i&&He(i,r.u.tex0);for(let l=0;l<t;++l)n(r.u,l),$e(c)},Ut=()=>{for(let e=0;e<_.w;++e)for(let t=0;t<_.h;++t){const n=H(e,t);if(!n)continue;const o=b(n.no);!o||L(o.draw,n.count,(r,c)=>{const i=F(e,t,c*o.height);f.m.set(B(i[0],i[1],i[2])),s.uniformMatrix4fv(r.w,!1,f.m)})}for(let e=0;e<_.w;++e)for(let t=0;t<_.h;++t){const n=ae(e,t);if(!n)continue;const o=b(n.no);if(!o)continue;const r=de(e,t);L(o.draw,1,(c,i)=>{const l=F(e,t,r);f.m.set(B(l[0],l[1],l[2])),s.uniformMatrix4fv(c.w,!1,f.m)})}},Nt=e=>{for(let t of e.ui){const n=le(t);if(!n)continue;const o=R[t];!o||L(n.draw,1,(r,c)=>{s.uniformMatrix4fv(r.w,!1,o.m)})}},Ft=e=>{L(e.skybox,1,(t,n)=>{f.m.set(B(...f.cam.eye)),s.uniformMatrix4fv(t.w,!1,f.m)})},Bt=e=>{Ft(e),e.draw3d&&Ut(),Nt(e)},Xt=()=>{Ne(),ze(),Oe(),je(),Qe(0)},Yt=e=>{if(lt(e),ke(),ue()){Ot();const t=ce(f.view);if(!t)return;_t(t),Pt(t)}It(),be()},Ct=()=>{if(Lt(),ue()){const e=ce(f.view);if(!e)return;Bt(e)}};x(window,"load",()=>{Xt();const e=t=>{Yt(t),Ct(),requestAnimationFrame(e)};e()});g.nextview=e=>{St(e)};g.resetview=()=>{fe()};g.newgame=e=>{f.slot=e,Gt()};g.loadgame=e=>{f.slot=e,kt()};g.savegame=()=>{bt()};const oe=(e,t,n,o)=>{const r=Math.floor(e),c=Math.floor(t),i=.25;let l=e+n,d=t+o;return T(r,c,-1,0)&&(l=Math.max(l,r+i)),T(r,c,1,0)&&(l=Math.min(l,r-i+1)),T(r,c,0,-1)&&(d=Math.max(d,c+i)),T(r,c,0,1)&&(d=Math.min(d,c-i+1)),T(r,c,-1,-1)&&([l,d]=O([l,d],i,[r,c])),T(r,c,-1,1)&&([l,d]=O([l,d],i,[r,c+1])),T(r,c,1,-1)&&([l,d]=O([l,d],i,[r+1,c])),T(r,c,1,1)&&([l,d]=O([l,d],i,[r+1,c+1])),[l,d]},$t=(e,t)=>{const n=M.dt,o=Y(t);o&&(a.ha+=90*n*o[0],a.va+=90*n*o[1],a.va=Math.max(-60,Math.min(a.va,80)));const r=Y(e);if(r){const l=S(a.ha+90),d=S(a.ha),m=r[0],E=r[1],A=m*Math.cos(l)+E*Math.cos(d),y=m*Math.sin(l)+E*Math.sin(d),h=2*n*A,_e=2*n*y;[a.x,a.y]=oe(a.x,a.y,h,_e)}else[a.x,a.y]=oe(a.x,a.y,0,0);const c=C(a.x,a.y);if(Math.abs(c-a.h)<=2){const i=c-a.h;a.h+=10*n*i}else a.h=c};g.fpsmove=(e,t)=>{$t(e,t)};g.makeworld=()=>{const e=ne("tile"),t=ne("mine");Et(64,64);for(let n=24;n<=40;++n)for(let o=24;o<=40;++o)xt(n,o,e);G(29,29,t),G(35,29,t),G(29,35,t),G(35,35,t),gt(_.w/2+.5,_.h/2+.5),Dt(8),yt(rt("pick"),1)};g.text=e=>{const t=ie(st(e));!t||(re(t.cvs,""+M.n),Fe(t.tex,t.cvs))};})();
