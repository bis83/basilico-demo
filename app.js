(()=>{const y=(e,t,r)=>{e.addEventListener(t,r)},E=()=>document.getElementById("canvas"),T=()=>document.getElementById("message"),Y=()=>{E().requestPointerLock()},w=()=>document.pointerLockElement===E(),O=e=>{const t=T();t.style.display="",t.textContent=e},J=()=>{const e=T();e.style.display="none"};const Q=(e,t)=>Math.floor(e/t),Z=(e,t)=>(e%t+t)%t,x=e=>e/180*Math.PI,ee=(e,t)=>Math.sqrt(e*e+t*t),P=(e,t)=>{const r=ee(e,t);return r!=0?[e/r,t/r]:[0,0]};const B=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],te=e=>{const t=B(e,e);return Math.sqrt(t)},ne=(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],re=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]];const F=e=>{const t=te(e);return[e[0]/t,e[1]/t,e[2]/t]},L=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],M=(e,t)=>{const r=x(e),n=x(t);return[Math.cos(n)*Math.cos(r),Math.sin(n),Math.cos(n)*Math.sin(r)]},oe=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],se=(e,t)=>[e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15]],ie=e=>{const t=e[0]*e[5]-e[1]*e[4],r=e[0]*e[6]-e[2]*e[4],n=e[0]*e[7]-e[3]*e[4],o=e[1]*e[6]-e[2]*e[5],s=e[1]*e[7]-e[3]*e[5],i=e[2]*e[7]-e[3]*e[6],a=e[8]*e[13]-e[9]*e[12],d=e[8]*e[14]-e[10]*e[12],l=e[8]*e[15]-e[11]*e[12],m=e[9]*e[14]-e[10]*e[13],u=e[9]*e[15]-e[11]*e[13],f=e[10]*e[15]-e[11]*e[14];let c=t*f-r*u+n*m+o*l-s*d+i*a;return c?(c=1/c,[(e[5]*f-e[6]*u+e[7]*m)*c,(e[2]*u-e[1]*f-e[3]*m)*c,(e[13]*i-e[14]*s+e[15]*o)*c,(e[10]*s-e[9]*i-e[11]*o)*c,(e[6]*l-e[4]*f-e[7]*d)*c,(e[0]*f-e[2]*l+e[3]*d)*c,(e[14]*n-e[12]*i-e[15]*r)*c,(e[8]*i-e[10]*n+e[11]*r)*c,(e[4]*u-e[5]*l+e[7]*a)*c,(e[1]*l-e[0]*u-e[3]*a)*c,(e[12]*s-e[13]*n+e[15]*t)*c,(e[9]*n-e[8]*s-e[11]*t)*c,(e[5]*d-e[4]*m-e[6]*a)*c,(e[0]*m-e[1]*d+e[2]*a)*c,(e[13]*r-e[12]*o-e[14]*t)*c,(e[8]*o-e[9]*r+e[10]*t)*c]):oe()};const ce=(e,t,r,n)=>{e[12]=t,e[13]=r,e[14]=n},ae=(e,t)=>{const r=x(e),n=Math.sin(r),o=Math.cos(r);return[o,0,n,0,0,1,0,0,-n,0,o,0,0,0,0,1]};const fe=(e,t,r)=>{const n=F(re(t,e)),o=F(L(r,n)),s=L(n,o),i=B(e,o),a=B(e,s),d=B(e,n);return[o[0],s[0],n[0],0,o[1],s[1],n[1],0,o[2],s[2],n[2],0,-i,-a,-d,1]},de=(e,t,r,n)=>{const o=1/Math.tan(e),s=o/t,i=n/(n-r),a=-(i*r);return[s,0,0,0,0,o,0,0,0,0,i,1,0,0,a,0]};const le=async(e,t)=>{e.adapter=await navigator.gpu.requestAdapter(),e.device=await e.adapter.requestDevice(),e.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),e.canvas=E(),e.context=e.canvas.getContext("webgpu"),e.context.configure({device:e.device,format:e.canvasFormat,alphaMode:"opaque"});const r=e.device;if(e.buffer)for(let o=0;o<e.buffer.length;++o){const s=e.buffer[o],i=await Ae(t[s.embed]),a=r.createBuffer({size:i.length,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.INDEX,mappedAtCreation:!0}),d=new DataView(a.getMappedRange());for(let l=0;l<i.length;++l)d.setUint8(l,i[l]);a.unmap(),e.buffer[o]=a}if(e.shader)for(let o=0;o<e.shader.length;++o){const s=e.shader[o],i=await Ve(t[s.embed]),a=r.createShaderModule({code:i});e.shader[o]=a}e.bindGroupLayout=[],e.pipelineLayout=[],e.pipeline=[],e.sampler=[],e.bindGroup=[],e.cbuffer=[],e.gbuffer=[];const n=(o,s,i)=>{e.cbuffer[o]=r.createBuffer({size:s,usage:i|GPUBufferUsage.COPY_DST})};n(0,512,GPUBufferUsage.UNIFORM),n(1,229376,GPUBufferUsage.STORAGE),n(2,65536,GPUBufferUsage.VERTEX),n(3,40960,GPUBufferUsage.INDIRECT),n(4,49152,GPUBufferUsage.VERTEX),n(5,16384,GPUBufferUsage.VERTEX),e.sampler[0]=r.createSampler({magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),e.bindGroupLayout[0]=r.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),e.bindGroupLayout[1]=r.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:5,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),e.pipelineLayout[0]=r.createPipelineLayout({bindGroupLayouts:[e.bindGroupLayout[0]]}),e.pipelineLayout[1]=r.createPipelineLayout({bindGroupLayouts:[e.bindGroupLayout[1]]}),e.bindGroup[0]=r.createBindGroup({layout:e.bindGroupLayout[0],entries:[{binding:0,resource:{buffer:e.cbuffer[0]}},{binding:1,resource:{buffer:e.cbuffer[1]}}]}),pe(e)},ue=(e,t)=>{for(let r=0;r<e.id.length;++r)if(e.id[r].name===t)return r;return-1},me=(e,t)=>{const r=e.device,n=new Float32Array(68);{const o=t.camera,s=e.canvas.width/e.canvas.height,i=x(o.fov),[a,d,l,m,u]=R(o.offset,0,0,0,0,0),f=M(m,u),c=[a,d,l],h=ne(c,f),b=fe(c,h,[0,1,0]),G=de(i,s,o.near,o.far),p=se(b,G),U=ie(p);n.set(p,0),n.set(U,16),n.set(b,32),n.set(c,48)}{const o=t.light,[s,i,a,d,l]=R(o.offset,0,0,0,0,0),m=g(o.color,0,0,0,0),u=g(o.ambient0,0,0,0,0),f=g(o.ambient1,0,0,0,0),c=M(d,l);n.set(c,52),n.set(m,56),n.set(u,60),n.set(f,64)}r.queue.writeBuffer(e.cbuffer[0],0,n)},he=(e,t)=>{const r=e.device;if(!t.lines||t.lines.length<=0)return 0;const n=new Float32Array(t.lines.length*3),o=new Uint8Array(t.lines.length*4);for(let s=0;s<t.lines.length;++s){const i=t.lines[s];n[s*3+0]=i.pos[0],n[s*3+1]=i.pos[1],n[s*3+2]=i.pos[2],o[s*4+0]=i.color[0],o[s*4+1]=i.color[1],o[s*4+2]=i.color[2],o[s*4+3]=i.color[3]}return r.queue.writeBuffer(e.cbuffer[4],0,n),r.queue.writeBuffer(e.cbuffer[5],0,o),t.lines.length},ye=(e,t,r)=>{const n=e.device,o=[];o.length=e.mesh.length;for(let f=0;f<o.length;++f)o[f]=[];const s=new Float32Array(28),i=4*28;let a=0;for(const f of t.room){const c=Te(r,f.name);if(c)for(let h=0;h<c.indices.length;++h){const S=c.node[c.indices[h]];if(!S)continue;const b=Z(h,c.divisor),G=Q(h,c.divisor),[p,U,$,D,k]=R(f.offset,b*c.unit,0,G*c.unit,0,0);for(const I of S.mesh){const v=c.mesh[I];if(!v)continue;const A=ue(e,v.name);if(A<0)continue;for(const K of e.id[A].mesh)o[K].push(a);const[C,z,q,N,X]=R(v.offset,p,U,$,D,k),V=ae(N,X);ce(V,C,z,q);const W=g(v.factor0,1,1,1,1),j=g(v.factor1,1,1,1,0),H=g(v.factor2,0,0,0,0);s.set(V,0),s.set(W,16),s.set(j,20),s.set(H,24),n.queue.writeBuffer(e.cbuffer[1],a*i,s),a+=1}}}const d=[];let l=0,m=0;const u=new Uint32Array(5);for(let f=0;f<o.length;++f){if(o[f].length<=0)continue;const c=e.mesh[f],h=o[f].length;n.queue.writeBuffer(e.cbuffer[2],l*4,new Uint32Array(o[f])),u[0]=c.count,u[1]=h,u[2]=0,u[3]=0,u[4]=0,n.queue.writeBuffer(e.cbuffer[3],m,u),d.push({id:f,first:l,offset:m}),l+=h,m+=20}return d},be=e=>{const t=e.device,r=e.canvas;if(r.width!==r.clientWidth||r.height!==r.clientHeight){r.width=r.clientWidth,r.height=r.clientHeight;const s=a=>{e.gbuffer[a]!==void 0&&(e.gbuffer[a].destroy(),delete e.gbuffer[a])};s(0),s(1),s(2),s(3),s(4);const i=a=>{e.bindGroup[a]!==void 0&&delete e.bindGroup[a]};i(1),i(2),i(3)}const n=(s,i)=>{e.gbuffer[s]===void 0&&(e.gbuffer[s]=t.createTexture({size:[r.width,r.height],format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}))};n(0,"depth32float"),n(1,"rgb10a2unorm"),n(2,"rgba8unorm"),n(3,"rgba8unorm"),n(4,"rgba16float");const o=(s,i,a,d,l)=>{e.bindGroup[s]===void 0&&(e.bindGroup[s]=t.createBindGroup({layout:e.bindGroupLayout[1],entries:[{binding:0,resource:{buffer:e.cbuffer[0]}},{binding:1,resource:e.gbuffer[i].createView()},{binding:2,resource:e.gbuffer[a].createView()},{binding:3,resource:e.gbuffer[d].createView()},{binding:4,resource:e.gbuffer[l].createView()},{binding:5,resource:e.sampler[0]}]}))};o(1,0,1,2,3),o(2,0,1,1,1),o(3,0,4,4,4)},pe=e=>{const t=e.device;e.pipeline[0]=t.createRenderPipeline({layout:e.pipelineLayout[0],vertex:{module:e.shader[0],entryPoint:"VS",buffers:[{arrayStride:4,attributes:[{format:"uint32",offset:0,shaderLocation:0}],stepMode:"instance"},{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:1}]},{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:2}]}]},fragment:{module:e.shader[0],entryPoint:"FS",targets:[{format:"rgb10a2unorm"},{format:"rgba8unorm"},{format:"rgba8unorm"},{format:"rgba16float"}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"},primitive:{cullMode:"back",frontFace:"cw"}}),e.pipeline[1]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_SSAO",targets:[{format:"rgba8unorm",blend:{color:{operation:"min",srcFactor:"one",dstFactor:"one"},alpha:{}},writeMask:GPUColorWrite.RED}]}}),e.pipeline[2]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDR",targets:[{format:"rgba16float",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"not-equal",format:"depth32float"}}),e.pipeline[3]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDRSky",targets:[{format:"rgba16float",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"equal",format:"depth32float"}}),e.pipeline[4]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDR2LDR",targets:[{format:e.canvasFormat}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"always",format:"depth32float"}}),e.pipeline[5]=t.createRenderPipeline({layout:e.pipelineLayout[0],vertex:{module:e.shader[2],entryPoint:"VS",buffers:[{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:0}]},{arrayStride:4,attributes:[{format:"unorm8x4",offset:0,shaderLocation:1}]}]},fragment:{module:e.shader[2],entryPoint:"FS",targets:[{format:e.canvasFormat}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"less",format:"depth32float"},primitive:{topology:"line-list"}})},ve=e=>{be(e)},we=(e,t,r)=>{me(e,t);const n=ye(e,t,r),o=he(e,t),s=e.device,i=s.createCommandEncoder();ge(i,e,n),xe(i,e),Se(i,e),Ge(i,e,o),s.queue.submit([i.finish()])},ge=(e,t,r)=>{const n=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"},colorAttachments:[{view:t.gbuffer[1].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[2].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[3].createView(),clearValue:{r:1,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[4].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});for(const o of r){n.setPipeline(t.pipeline[0]),n.setBindGroup(0,t.bindGroup[0]),n.setVertexBuffer(0,t.cbuffer[2],o.first*4);const s=t.mesh[o.id];if(s.vb0){const[i,a,d]=s.vb0;n.setVertexBuffer(1,t.buffer[i],a,d)}if(s.vb1){const[i,a,d]=s.vb1;n.setVertexBuffer(2,t.buffer[i],a,d)}if(s.ib){const[i,a,d]=s.ib;n.setIndexBuffer(t.buffer[i],"uint16",a,d)}n.drawIndexedIndirect(t.cbuffer[3],o.offset)}n.end()},xe=(e,t)=>{const r=e.beginRenderPass({colorAttachments:[{view:t.gbuffer[3].createView(),loadOp:"load",storeOp:"store"}]});r.setPipeline(t.pipeline[1]),r.setBindGroup(0,t.bindGroup[2]),r.draw(4),r.end()},Se=(e,t)=>{const r=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthReadOnly:!0},colorAttachments:[{view:t.gbuffer[4].createView(),loadOp:"load",storeOp:"store"}]});r.setPipeline(t.pipeline[2]),r.setBindGroup(0,t.bindGroup[1]),r.draw(4),r.setPipeline(t.pipeline[3]),r.draw(4),r.end()},Ge=(e,t,r)=>{const n=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthReadOnly:!0},colorAttachments:[{view:t.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});n.setPipeline(t.pipeline[4]),n.setBindGroup(0,t.bindGroup[3]),n.draw(4),r&&(n.setPipeline(t.pipeline[5]),n.setBindGroup(0,t.bindGroup[0]),n.setVertexBuffer(0,t.cbuffer[4]),n.setVertexBuffer(1,t.cbuffer[5]),n.draw(r)),n.end()},Pe=e=>{e.timer.t=performance.now();const t={KeyW:"w",KeyA:"a",KeyS:"s",KeyD:"d",ArrowUp:"up",ArrowLeft:"left",ArrowDown:"down",ArrowRight:"right",KeyQ:"q",KeyE:"e",KeyZ:"z",KeyX:"x",Space:"space",ControlLeft:"lctrl",Escape:"esc"},r={0:"b0",1:"b1",2:"b2",3:"b3",4:"b4"};y(window,"focus",n=>{}),y(window,"blur",n=>{const o=e.mkey;for(const s in t)o[t[s]]=!1;for(const s in r)o[r[s]]=!1;o.mx=0,o.my=0}),y(window,"resize",n=>{}),y(window,"gamepadconnected",n=>{e.gpad.id=n.gamepad.index}),y(window,"gamepaddisconnected",n=>{e.gpad.id===n.gamepad.index&&(e.gpad.id=null)}),y(document,"keydown",n=>{if(w()){const o=t[n.code];o&&(e.mkey[o]=!0,n.preventDefault())}}),y(document,"keyup",n=>{if(w()){const o=t[n.code];o&&(e.mkey[o]=!1,n.preventDefault())}}),y(document,"click",n=>{w()||Y()}),y(document,"mousedown",n=>{if(w()){const o=r[n.button];o&&(e.mkey[o]=!0,n.preventDefault())}}),y(document,"mouseup",n=>{if(w()){const o=r[n.button];o&&(e.mkey[o]=!1,n.preventDefault())}}),y(document,"mousemove",n=>{w()&&(e.mkey.mx=n.movementX,e.mkey.my=n.movementY,n.preventDefault())}),y(document.body,"contextmenu",n=>{n.preventDefault()})},_e=(e,t)=>{{const r=e.timer;r.dt=(t-r.t)/1e3,r.t=t,r.n+=1}{const r=e.gpad;if(r.id!==null){const n=navigator.getGamepads()[r.id];r.lx=Math.trunc(n.axes[0]*4)/4,r.ly=Math.trunc(n.axes[1]*4)/4,r.rx=Math.trunc(n.axes[2]*4)/4,r.ry=Math.trunc(n.axes[3]*4)/4,r.b0=n.buttons[0].value>=.5,r.b1=n.buttons[1].value>=.5,r.b8=n.buttons[8].value>=.5,r.b9=n.buttons[9].value>=.5,r.lb=n.buttons[4].value>=.5,r.rb=n.buttons[5].value>=.5,r.lt=n.buttons[6].value>=.5,r.rt=n.buttons[7].value>=.5}}},Be=e=>{{const t=e.mkey;t.mx=0,t.my=0}},Re=e=>e.timer.dt,_=(e,t,r)=>{if(t){const n=e.mkey;if(t==="wasd"){const o=n.a?-1:n.d?1:0,s=n.w?1:n.s?-1:0;if(o!==0||s!==0)return P(o,s)}else if(t==="arrow"){const o=n.right?1:n.left?-1:0,s=n.up?1:n.down?-1:0;if(o!==0||s!==0)return P(o,s)}else if(t==="mouse"){const o=n.mx,s=-n.my;if(o!==0||s!==0)return P(o,s)}else if(n[t])return[1,0]}if(r){const n=e.gpad;if(r==="ls")return P(n.lx,-n.ly);if(r==="rs")return P(n.rx,-n.ry);if(n[r])return[1,0]}return null},Ue=(e,t)=>{e.lines=[];for(const r of t)e.lines.push({pos:r.from,color:r.color}),e.lines.push({pos:r.to,color:r.color})},R=(e,t,r,n,o,s)=>(e&&(t+=e.x||0,r+=e.y||0,n+=e.z||0,o+=e.ha||0,s+=e.va||0),[t,r,n,o,s]),g=(e,t,r,n,o)=>(e&&(e.r!==void 0&&(t=e.r),e.g!==void 0&&(r=e.g),e.r!==void 0&&(n=e.b),e.a!==void 0&&(o=e.a)),[t,r,n,o]),Ee=e=>{e.loading+=1,(async()=>{const n=await(await fetch("app.json")).json();Object.assign(e,n),e.gpu&&await le(e.gpu,e.embed),e.com&&Pe(e.com),delete e.embed,e.loading-=1})()},Ae=async e=>{const t=window.atob(e),r=new Uint8Array(t.length);for(let s=0;s<t.length;++s)r[s]=t.charCodeAt(s);const n=new Blob([r]).stream().pipeThrough(new DecompressionStream("deflate-raw")),o=await new Response(n).arrayBuffer();return new Uint8Array(o)},Ve=async e=>{const t=window.atob(e),r=new Uint8Array(t.length);for(let s=0;s<t.length;++s)r[s]=t.charCodeAt(s);const n=new Blob([r]).stream().pipeThrough(new DecompressionStream("deflate-raw"));return await new Response(n).text()},Fe=async(e,t)=>{if(!navigator.gpu){O("ERROR: WebGPU not supported.");return}const r={loading:0};Ee(r);const n=o=>{Le(r)&&(_e(r.com,o),ve(r.gpu),e&&(e(r),e=null),t&&t(r),we(r.gpu,r.view,r),Be(r.com)),requestAnimationFrame(n)};requestAnimationFrame(n)},Le=e=>e.loading<=0,Me=(e,t)=>e.json[t],Te=(e,t)=>e.room[t],Oe=e=>{J(),Object.assign(e.view,Me(e,"sample")),De(e)},$e=e=>{const t=e.com,r=e.view,n=r.camera,o=Re(t),s=_(t,"wasd","ls"),i=_(t,"mouse","rs");if(i){const u=-i[0],f=i[1];n.offset.ha+=90*o*u,n.offset.va+=90*o*f,n.offset.va=Math.max(-60,Math.min(n.offset.va,80))}if(s){const u=x(n.offset.ha+90),f=x(n.offset.ha),c=-s[0],h=s[1],S=c*Math.cos(u)+h*Math.cos(f),b=c*Math.sin(u)+h*Math.sin(f),G=2*o*S,p=2*o*b;n.offset.x+=G,n.offset.z+=p}_(t,"q","lb")&&(n.offset.y-=.75*o),_(t,"e","rb")&&(n.offset.y+=.75*o);const l=r.light;l.offset.ha+=45*o};y(window,"load",()=>{O("Welcome Basilico."),Fe(Oe,$e)});const De=e=>{const t=[];t.push({from:[-50,0,0],to:[50,0,0],color:[255,0,0,255]}),t.push({from:[0,0,-50],to:[0,0,50],color:[0,0,255,255]}),Ue(e.view,t)};})();
