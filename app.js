(()=>{const y=(e,t,n)=>{e.addEventListener(t,n)},z=()=>document.getElementById("canvas"),W=()=>document.getElementById("message"),te=()=>{z().requestPointerLock()},U=()=>document.pointerLockElement===z(),Y=e=>{const t=W();t.style.display="",t.textContent=e},ne=()=>{const e=W();e.style.display="none"};const p=e=>e!==void 0,oe=(e,t)=>Math.floor(e/t),re=(e,t)=>(e%t+t)%t,R=e=>e/180*Math.PI;const F=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],se=e=>{const t=F(e,e);return Math.sqrt(t)},ie=(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],ce=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]];const C=e=>{const t=se(e);return[e[0]/t,e[1]/t,e[2]/t]},q=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],N=(e,t)=>{const n=R(e),r=R(t);return[Math.cos(r)*Math.cos(n),Math.sin(r),Math.cos(r)*Math.sin(n)]},ae=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fe=(e,t)=>[e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15]],de=e=>{const t=e[0]*e[5]-e[1]*e[4],n=e[0]*e[6]-e[2]*e[4],r=e[0]*e[7]-e[3]*e[4],o=e[1]*e[6]-e[2]*e[5],i=e[1]*e[7]-e[3]*e[5],s=e[2]*e[7]-e[3]*e[6],c=e[8]*e[13]-e[9]*e[12],a=e[8]*e[14]-e[10]*e[12],d=e[8]*e[15]-e[11]*e[12],m=e[9]*e[14]-e[10]*e[13],l=e[9]*e[15]-e[11]*e[13],u=e[10]*e[15]-e[11]*e[14];let f=t*u-n*l+r*m+o*d-i*a+s*c;return f?(f=1/f,[(e[5]*u-e[6]*l+e[7]*m)*f,(e[2]*l-e[1]*u-e[3]*m)*f,(e[13]*s-e[14]*i+e[15]*o)*f,(e[10]*i-e[9]*s-e[11]*o)*f,(e[6]*d-e[4]*u-e[7]*a)*f,(e[0]*u-e[2]*d+e[3]*a)*f,(e[14]*r-e[12]*s-e[15]*n)*f,(e[8]*s-e[10]*r+e[11]*n)*f,(e[4]*l-e[5]*d+e[7]*c)*f,(e[1]*d-e[0]*l-e[3]*c)*f,(e[12]*i-e[13]*r+e[15]*t)*f,(e[9]*r-e[8]*i-e[11]*t)*f,(e[5]*a-e[4]*m-e[6]*c)*f,(e[0]*m-e[1]*a+e[2]*c)*f,(e[13]*n-e[12]*o-e[14]*t)*f,(e[8]*o-e[9]*n+e[10]*t)*f]):ae()};const X=(e,t,n,r)=>{e[12]=t,e[13]=n,e[14]=r},j=(e,t)=>{const n=R(e),r=Math.sin(n),o=Math.cos(n);return[o,0,r,0,0,1,0,0,-r,0,o,0,0,0,0,1]};const le=(e,t,n)=>{const r=C(ce(t,e)),o=C(q(n,r)),i=q(r,o),s=F(e,o),c=F(e,i),a=F(e,r);return[o[0],i[0],r[0],0,o[1],i[1],r[1],0,o[2],i[2],r[2],0,-s,-c,-a,1]},ue=(e,t,n,r)=>{const o=1/Math.tan(e),i=o/t,s=r/(r-n),c=-(s*n);return[i,0,0,0,0,o,0,0,0,0,s,1,0,0,c,0]};const me=async(e,t)=>{e.adapter=await navigator.gpu.requestAdapter(),e.device=await e.adapter.requestDevice(),e.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),e.canvas=z(),e.context=e.canvas.getContext("webgpu"),e.context.configure({device:e.device,format:e.canvasFormat,alphaMode:"opaque"});const n=e.device;if(e.buffer)for(let o=0;o<e.buffer.length;++o){const i=e.buffer[o],s=await Oe(t[i.embed]),c=n.createBuffer({size:s.length,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.INDEX,mappedAtCreation:!0}),a=new DataView(c.getMappedRange());for(let d=0;d<s.length;++d)a.setUint8(d,s[d]);c.unmap(),e.buffer[o]=c}if(e.shader)for(let o=0;o<e.shader.length;++o){const i=e.shader[o],s=await Te(t[i.embed]),c=n.createShaderModule({code:s});e.shader[o]=c}e.bindGroupLayout=[],e.pipelineLayout=[],e.pipeline=[],e.sampler=[],e.bindGroup=[],e.cbuffer=[],e.gbuffer=[];const r=(o,i,s)=>{e.cbuffer[o]=n.createBuffer({size:i,usage:s|GPUBufferUsage.COPY_DST})};r(0,512,GPUBufferUsage.UNIFORM),r(1,229376,GPUBufferUsage.STORAGE),r(2,65536,GPUBufferUsage.VERTEX),r(3,40960,GPUBufferUsage.INDIRECT),e.sampler[0]=n.createSampler({magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),e.bindGroupLayout[0]=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),e.bindGroupLayout[1]=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:5,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),e.pipelineLayout[0]=n.createPipelineLayout({bindGroupLayouts:[e.bindGroupLayout[0]]}),e.pipelineLayout[1]=n.createPipelineLayout({bindGroupLayouts:[e.bindGroupLayout[1]]}),e.bindGroup[0]=n.createBindGroup({layout:e.bindGroupLayout[0],entries:[{binding:0,resource:{buffer:e.cbuffer[0]}},{binding:1,resource:{buffer:e.cbuffer[1]}}]}),ve(e)},H=(e,t)=>{for(let n=0;n<e.id.length;++n)if(e.id[n].name===t)return n;return-1},he=e=>{const t=e.data.gpu,n=t.device,r=new Float32Array(68);{const o=e.camera,i=t.canvas.width/t.canvas.height,s=R(o.fov),[c,a,d,m,l]=M(o.offset,0,0,0,0,0),u=N(m,l),f=[c,a,d],_=ie(f,u),w=le(f,_,[0,1,0]),S=ue(s,i,o.near,o.far),b=fe(w,S),P=de(b);r.set(b,0),r.set(P,16),r.set(w,32),r.set(f,48)}{const o=e.light,[i,s,c,a,d]=M(o.offset,0,0,0,0,0),m=v(o.color,0,0,0,0),l=v(o.ambient0,0,0,0,0),u=v(o.ambient1,0,0,0,0),f=N(a,d);r.set(f,52),r.set(m,56),r.set(l,60),r.set(u,64)}n.queue.writeBuffer(t.cbuffer[0],0,r)},be=e=>{const t=e.data.gpu,n=t.device,r=[];r.length=t.mesh.length;for(let l=0;l<r.length;++l)r[l]=[];const o=new Float32Array(28),i=4*28;let s=0;if(e.room)for(const l of e.room){const u=ke(e,l.name);if(u)for(let f=0;f<u.indices.length;++f){const _=u.node[u.indices[f]];if(!_)continue;const G=re(f,u.divisor),w=oe(f,u.divisor),[S,b,P,V,L]=M(l.offset,G*u.unit,0,w*u.unit,0,0);for(const A of _.mesh){const x=u.mesh[A];if(!x)continue;const B=H(t,x.name);if(B<0)continue;for(const ee of t.id[B].mesh)r[ee].push(s);const[E,O,T,D,I]=M(x.offset,S,b,P,V,L),k=j(D,I);X(k,E,O,T);const K=v(x.factor0,1,1,1,1),Q=v(x.factor1,1,1,1,0),Z=v(x.factor2,0,0,0,0);o.set(k,0),o.set(K,16),o.set(Q,20),o.set(Z,24),n.queue.writeBuffer(t.cbuffer[1],s*i,o),s+=1}}}if(e.mob)for(const l of e.mob){const u=Ce(e,l.name);if(!u)continue;const[f,_,G,w,S]=M(l.offset,0,0,0,0,0);for(const b of u.mesh){const P=H(t,b.name);if(P<0)continue;for(const I of t.id[P].mesh)r[I].push(s);const[V,L,A,x,B]=M(b.offset,f,_,G,w,S),E=j(x,B);X(E,V,L,A);const O=v(b.factor0,1,1,1,1),T=v(b.factor1,1,1,1,0),D=v(b.factor2,0,0,0,0);o.set(E,0),o.set(O,16),o.set(T,20),o.set(D,24),n.queue.writeBuffer(t.cbuffer[1],s*i,o),s+=1}}const c=[];let a=0,d=0;const m=new Uint32Array(5);for(let l=0;l<r.length;++l){if(r[l].length<=0)continue;const u=t.mesh[l],f=r[l].length;n.queue.writeBuffer(t.cbuffer[2],a*4,new Uint32Array(r[l])),m[0]=u.count,m[1]=f,m[2]=0,m[3]=0,m[4]=0,n.queue.writeBuffer(t.cbuffer[3],d,m),c.push({id:l,first:a,offset:d}),a+=f,d+=20}return c},ye=e=>{const t=e.device,n=e.canvas;if(n.width!==n.clientWidth||n.height!==n.clientHeight){n.width=n.clientWidth,n.height=n.clientHeight;const i=c=>{p(e.gbuffer[c])&&(e.gbuffer[c].destroy(),delete e.gbuffer[c])};i(0),i(1),i(2),i(3),i(4);const s=c=>{p(e.bindGroup[c])&&delete e.bindGroup[c]};s(1),s(2),s(3)}const r=(i,s)=>{p(e.gbuffer[i])||(e.gbuffer[i]=t.createTexture({size:[n.width,n.height],format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}))};r(0,"depth32float"),r(1,"rgb10a2unorm"),r(2,"rgba8unorm"),r(3,"rgba8unorm"),r(4,"rgba16float");const o=(i,s,c,a,d)=>{p(e.bindGroup[i])||(e.bindGroup[i]=t.createBindGroup({layout:e.bindGroupLayout[1],entries:[{binding:0,resource:{buffer:e.cbuffer[0]}},{binding:1,resource:e.gbuffer[s].createView()},{binding:2,resource:e.gbuffer[c].createView()},{binding:3,resource:e.gbuffer[a].createView()},{binding:4,resource:e.gbuffer[d].createView()},{binding:5,resource:e.sampler[0]}]}))};o(1,0,1,2,3),o(2,0,1,1,1),o(3,0,4,4,4)},ve=e=>{const t=e.device;e.pipeline[0]=t.createRenderPipeline({layout:e.pipelineLayout[0],vertex:{module:e.shader[0],entryPoint:"VS",buffers:[{arrayStride:4,attributes:[{format:"uint32",offset:0,shaderLocation:0}],stepMode:"instance"},{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:1}]},{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:2}]}]},fragment:{module:e.shader[0],entryPoint:"FS",targets:[{format:"rgb10a2unorm"},{format:"rgba8unorm"},{format:"rgba8unorm"},{format:"rgba16float"}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"},primitive:{cullMode:"back",frontFace:"cw"}}),e.pipeline[1]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_SSAO",targets:[{format:"rgba8unorm",blend:{color:{operation:"min",srcFactor:"one",dstFactor:"one"},alpha:{}},writeMask:GPUColorWrite.RED}]}}),e.pipeline[2]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDR",targets:[{format:"rgba16float",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"not-equal",format:"depth32float"}}),e.pipeline[3]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDRSky",targets:[{format:"rgba16float",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"equal",format:"depth32float"}}),e.pipeline[4]=t.createRenderPipeline({layout:e.pipelineLayout[1],vertex:{module:e.shader[1],entryPoint:"VS",buffers:[]},fragment:{module:e.shader[1],entryPoint:"FS_HDR2LDR",targets:[{format:e.canvasFormat}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"always",format:"depth32float"}}),e.pipeline[5]=t.createRenderPipeline({layout:e.pipelineLayout[0],vertex:{module:e.shader[2],entryPoint:"VS",buffers:[{arrayStride:12,attributes:[{format:"float32x3",offset:0,shaderLocation:0}]},{arrayStride:4,attributes:[{format:"unorm8x4",offset:0,shaderLocation:1}]}]},fragment:{module:e.shader[2],entryPoint:"FS",targets:[{format:e.canvasFormat}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"less",format:"depth32float"},primitive:{topology:"line-list"}})},pe=e=>{const t=e.data.gpu;ye(t)},ge=e=>{he(e);const t=be(e),n=e.data.gpu,r=n.device,o=r.createCommandEncoder();_e(o,n,t),we(o,n),xe(o,n),Se(o,n),r.queue.submit([o.finish()])},_e=(e,t,n)=>{const r=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"},colorAttachments:[{view:t.gbuffer[1].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[2].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[3].createView(),clearValue:{r:1,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:t.gbuffer[4].createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});for(const o of n){r.setPipeline(t.pipeline[0]),r.setBindGroup(0,t.bindGroup[0]),r.setVertexBuffer(0,t.cbuffer[2],o.first*4);const i=t.mesh[o.id];if(i.vb0){const[s,c,a]=i.vb0;r.setVertexBuffer(1,t.buffer[s],c,a)}if(i.vb1){const[s,c,a]=i.vb1;r.setVertexBuffer(2,t.buffer[s],c,a)}if(i.ib){const[s,c,a]=i.ib;r.setIndexBuffer(t.buffer[s],"uint16",c,a)}r.drawIndexedIndirect(t.cbuffer[3],o.offset)}r.end()},we=(e,t)=>{const n=e.beginRenderPass({colorAttachments:[{view:t.gbuffer[3].createView(),loadOp:"load",storeOp:"store"}]});n.setPipeline(t.pipeline[1]),n.setBindGroup(0,t.bindGroup[2]),n.draw(4),n.end()},xe=(e,t)=>{const n=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthReadOnly:!0},colorAttachments:[{view:t.gbuffer[4].createView(),loadOp:"load",storeOp:"store"}]});n.setPipeline(t.pipeline[2]),n.setBindGroup(0,t.bindGroup[1]),n.draw(4),n.setPipeline(t.pipeline[3]),n.draw(4),n.end()},Se=(e,t)=>{const n=e.beginRenderPass({depthStencilAttachment:{view:t.gbuffer[0].createView(),depthReadOnly:!0},colorAttachments:[{view:t.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});n.setPipeline(t.pipeline[4]),n.setBindGroup(0,t.bindGroup[3]),n.draw(4),n.end()},J=(e,t)=>{e[t]||(e[t]={})},g=(e,t,n)=>{J(e,t),n=n||0;const r=e[t];r&&!r.hold&&(r.value=Math.max(0,n))},$=(e,t,n,r)=>{J(e,t),n=n||0,r=r||!1;const o=e[t];o&&(o.value=Math.max(0,n),o.hold=r)},Ge=(e,t)=>{const n=e[t];n&&(n.history=n.value)},Pe=(e,t)=>{const n=e[t];return n?n.value:0},Me=(e,t)=>{const n=e[t];return n?n.value-n.history:0},Re=e=>{if(!e)return!1;for(const t of e.buttons)if(t.value>.5)return!0;for(const t of e.axes)if(Math.abs(t)>.5)return!0;return!1},Be=e=>{const t=e.hid,n=e.data.hid,r=()=>{for(const s in n.keyboard)$(t.map,n.keyboard[s],0,!1);for(const s of n.mouse.button)$(t.map,s,0,!1)},o=(s,c,a)=>{if(!U())return;const d=n.keyboard[s.code];d&&($(t.map,d,c,a),s.preventDefault(),t.last=-1)},i=(s,c,a)=>{if(!U())return;const d=n.mouse.button[s.button];d&&($(t.map,d,c,a),s.preventDefault(),t.last=-1)};y(document.body,"contextmenu",s=>{s.preventDefault()}),y(window,"blur",s=>{r()}),y(document,"click",s=>{U()||(te(),r())}),y(document,"keydown",s=>{o(s,1,!0)}),y(document,"keyup",s=>{o(s,0,!1)}),y(document,"mousedown",s=>{i(s,1,!0)}),y(document,"mouseup",s=>{i(s,0,!1)}),y(document,"mousemove",s=>{if(!U())return;const c=.25,a=n.mouse.movementX;a&&(g(t.map,a[0],-s.movementX*c),g(t.map,a[1],s.movementX*c));const d=n.mouse.movementY;d&&(g(t.map,d[0],-s.movementY*c),g(t.map,d[1],s.movementY*c)),s.preventDefault(),t.last=-1})},Ee=(e,t)=>{const n=e.hid,r=e.data.hid;g(n.map,r.timer,t/1e3);{const o=navigator.getGamepads();for(let s=0;s<o.length;++s)if(Re(o[s])){n.last=s;break}const i=o[n.last];if(i){const s=r.gamepad;for(let c=0;c<i.buttons.length;++c){const a=s.buttons[c];a&&g(n.map,a,i.buttons[c].value)}for(let c=0;c<i.axes.length;++c){const a=s.axes[c];if(!a)continue;const d=Math.trunc(i.axes[c]*4)/4;g(n.map,a[0],-d),g(n.map,a[1],d)}}}},Ue=e=>{const t=e.hid;for(const n in t.map)Ge(t.map,n),g(t.map,n,0)},$e=e=>{e.data.func&&Fe(e,"main")},Fe=(e,t)=>{p(e.data.func[t])&&e.func.push({name:t,branch:0,action:0})},Ve=(e,t)=>{const n=e.data.func[t.name];if(!n){t.branch=-1;return}for(;;){const r=n.branch[t.branch];if(!r){t.branch=-1;break}const o=r.action[t.action];if(!o){t.branch+=r.next,t.action=0;break}const i=e.exec[o];i&&i(e),t.action+=1}},Le=e=>{if(e.func){for(const t of e.func)Ve(e,t);e.func=e.func.filter(t=>t.branch>=0)}},M=(e,t,n,r,o,i)=>(e&&(t+=e.x||0,n+=e.y||0,r+=e.z||0,o+=e.ha||0,i+=e.va||0),[t,n,r,o,i]),v=(e,t,n,r,o)=>(e&&(p(e.r)&&(t=e.r),p(e.g)&&(n=e.g),p(e.r)&&(r=e.b),p(e.a)&&(o=e.a)),[t,n,r,o]),Ae=e=>{e.data.loading+=1,(async()=>{const r=await(await fetch("app.json")).json(),o=e.data;Object.assign(o,r),Be(e),o.gpu&&await me(o.gpu,o.embed),$e(e),delete o.embed,o.loading-=1})()},Oe=async e=>{const t=window.atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);const r=new Blob([n]).stream().pipeThrough(new DecompressionStream("deflate-raw")),o=await new Response(r).arrayBuffer();return new Uint8Array(o)},Te=async e=>{const t=window.atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);const r=new Blob([n]).stream().pipeThrough(new DecompressionStream("deflate-raw"));return await new Response(r).text()},De=async e=>{if(!navigator.gpu){Y("ERROR: WebGPU not supported.");return}const t={exec:e,data:{loading:0},hid:{map:{},last:0},func:[],room:[],mob:[],camera:{offset:{x:0,y:0,z:0},fov:0,near:0,far:0},light:{offset:{ha:0,va:0},color:{r:0,g:0,b:0},ambient0:{r:0,g:0,b:0},ambient1:{r:0,g:0,b:0}}};Ae(t);const n=r=>{Ie(t)&&(Ee(t,r),pe(t),Le(t),ge(t),Ue(t)),requestAnimationFrame(n)};requestAnimationFrame(n)},Ie=e=>e.data.loading<=0,ze=(e,t)=>e.data.json[t],ke=(e,t)=>e.data.room[t],Ce=(e,t)=>e.data.mob[t],h=(e,t)=>Pe(e.hid.map,t),qe=(e,t)=>Me(e.hid.map,t),Ne=e=>{ne(),Object.assign(e,ze(e,"sample"))},Xe=e=>{const t=qe(e,"t"),n=e.mob.find(o=>o.name==="p000");if(n){const o=[0,0];o[0]+=-h(e,"l0"),o[0]+=h(e,"l1"),o[1]+=h(e,"l2"),o[1]+=-h(e,"l3");const i=[0,0];i[0]+=-h(e,"r0"),i[0]+=h(e,"r1"),i[1]+=h(e,"r2"),i[1]+=-h(e,"r3");const s=h(e,"b1");if(i){const m=-i[0],l=i[1];n.offset.ha+=90*t*m,n.offset.va+=90*t*l,n.offset.va=Math.max(-60,Math.min(n.offset.va,80))}if(o){const d=s?4:2,m=R(n.offset.ha+90),l=R(n.offset.ha),u=-o[0],f=o[1],_=u*Math.cos(m)+f*Math.cos(l),G=u*Math.sin(m)+f*Math.sin(l),w=d*t*_,S=d*t*G;n.offset.x+=w,n.offset.z+=S}h(e,"a2")&&(n.offset.y-=.75*t),h(e,"a3")&&(n.offset.y+=.75*t),e.camera.offset.x=n.offset.x,e.camera.offset.y=n.offset.y,e.camera.offset.z=n.offset.z,e.camera.offset.ha=n.offset.ha,e.camera.offset.va=n.offset.va}const r=e.light;r.offset.ha+=45*t};y(window,"load",()=>{Y("Welcome Basilico."),De({setup:Ne,update:Xe})});})();
